# Booth-Email-Colloector BOOTH 売上自動収集 & 分析ダッシュボード

Google Apps Script を使って **BOOTH 売上通知メール**を自動収集し、  
Google スプレッドシートに記録、さらにウェブ UI で可視化する仕組み。

---

## 📂 プロジェクト構成
├── front.gs # doGet(), UI 用バックエンド API
├── main.gs # BOOTH メール解析 & スプレッドシート書き込みロジック
├── Index.html # フロントエンド UI (設定/分析ダッシュボード)

---

## 🚀 セットアップ手順（詳細）

### 1. プロジェクト作成
1. https://script.google.com/ にアクセス  
2. 「新しいプロジェクト」をクリック  
3. プロジェクト名を「BOOTH Email Collector」など分かりやすい名前に変更  

---

### 2. ファイル追加
1. エディタ左の **ファイル一覧** で「＋」→「スクリプトファイル」を選択し、  
   `main.gs` を作成 → `main.gs` のコードを貼り付け  
2. 同様に `front.gs` を作成 → `front.gs` のコードを貼り付け  
3. 「＋」→「HTML ファイル」を選択し、名前を **Index** にする → `Index.html` のコードを貼り付け  

> ⚠️ HTML ファイルは必ず `Index` という名前にすること。  
> そうしないと `doGet()` がエラーを出す。  

---

### 3. スプレッドシート準備
1. Google ドライブで新しいスプレッドシートを作成  
2. アドレスバーの URL を確認
https://docs.google.com/spreadsheets/d/xxxxxxxxxxxxxxxxxxxxxxxx/edit
3. `xxxxxxxxxxxxxxxxxxxxxxxx` の部分が **SPREADSHEET_ID** になるので控える  

---

### 4. GAS の設定
1. エディタの上部メニュー「デプロイ」→「新しいデプロイ」をクリック  
2. 種類を「ウェブアプリ」に変更  
- 実行するアプリ: `doGet`  
- 実行者: 自分  
- アクセスできるユーザー: 「全員（匿名含む）」または「リンクを知っている全員」  
3. デプロイすると URL が発行される → これがダッシュボードのアクセス URL  

---

### 5. 初期設定（UI で実施）
1. 発行された URL にアクセス  
2. 「設定」タブを開く  
- **SPREADSHEET_ID** に控えた ID を入力  
- **MAX_SCAN_COUNT** に処理するメール件数（例: 200）を入力  
- 「保存」ボタンを押す  
3. 「初期セットアップ」ボタンを押す  
- Gmail・スプレッドシートへのアクセス権限が求められるので承認  
- ラベル・シートが自動で作成される  

---

### 6. 定期実行（トリガー）
1. 「定期抽出（5分）」トグルを ON にする  
2. Google Apps Script 側で 5分ごとのトリガーが自動で作成される  
→ BOOTH の売上メールを定期的に収集・スプレッドシートに記録  

---

## 📊 ダッシュボード機能

### 設定ページ
- **SPREADSHEET_ID** 入力欄
- **MAX_SCAN_COUNT** 入力欄
- **初期セットアップ** ボタン
- **定期抽出（5分）ON/OFF** トグル

### 分析ページ
- **商品別売上件数折れ線グラフ**（日別/週別/月別切替）
- **商品別売上金額折れ線グラフ**（日別/週別/月別切替）
- **商品ごと時間帯別（2時間ごと）売上件数棒グラフ**  
（週トータル / 月トータル / 累計切替 + 商品選択）

---

## 📑 スプレッドシート形式
| 注文日時           | 注文番号 | 商品名   | 版情報 | 金額   |
|--------------------|----------|----------|--------|--------|
| 2025/01/01 12:00   | 12345678 | サンプル | 通常版 | ¥1,000 |

---

## 🔒 権限
初回アクセス時に以下の権限を要求される:
- Gmail の読み取り
- スプレッドシートの編集
- Apps Script トリガーの作成・削除

---

## 🛠️ トラブルシューティング

- **`Exception: 「Index」という HTML ファイルは見つかりませんでした`**  
→ `Index.html` が作成されていない。必ず `Index` という名前で追加する。  

- **売上がスプレッドシートに記録されない**  
→ `SPREADSHEET_ID` が正しいか確認。  
→ BOOTH の売上通知が `noreply@booth.pm` から届いているか確認。  

- **大量メールで処理が止まる**  
→ 自動で「処理中」ラベルが付与される。次回実行時に続きから処理される。  

